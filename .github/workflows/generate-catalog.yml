name: Generate FBC catalogs

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]
    branches:
      - main
    paths:
      - 'hack/update-catalog.sh'

jobs:
  update-catalog:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Log into registry.redhat.io
        uses: docker/login-action@74a5d142397b4f367a81961eba4e8cd7edddf772 # v3.4.0
        with:
          registry: registry.redhat.io
          username: ${{ secrets.RH_REGISTRY_USERNAME }}
          password: ${{ secrets.RH_REGISTRY_TOKEN }}

      - name: Generate catalog
        run: |
          make generate-catalog

      - uses: gr2m/create-or-update-pull-request-action@v1
        # env:
        #   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          title: "Generate FBC catalogs"
          body: "Update the catalogs to the latest bundle sha"
          branch: "actions/generate-catalog"
          path: "catalog/"
          commit-message: "chore: generate catalog for bundle"
          author: "Github actions"
          # labels: label1, label2
          # assignees: user1, user2
          # reviewers: user1, user2
          # team_reviewers: team1, team2
          update-pull-request-title-and-body: true
